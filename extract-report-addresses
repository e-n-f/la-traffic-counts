#!/usr/bin/perl

open(IN, "la-intersections");
while (<IN>) {
	chomp;
	($name, $lat, $lon) = split(/,/);
	$name =~ tr/a-z/A-Z/;
	$name =~ s/^[NSEW] //;
	$name =~ s/\bAT [NSEW] /AT /;
	$name =~ s/\bROAD\b/RD/g;

	if ($lat{$name} ne "") {
		if ($lat{$name} ne $lat || $lon{$name} ne $lon) {
			$dup{$name} = 1;
			next;
		}
	}

	$lat{$name} = $lat;
	$lon{$name} = $lon;
}
close(IN);

for $n (keys(%dup)) {
	$lat{$n} = "";
	$lon{$n} = "";
}

for $file (<reports/*.html>) {
	open (IN, "<$file");
	while (<IN>) {
		last if /<td class="tablerecord">/;
	}

	<IN>;
	$_ = <IN>;

	s/\015//;
	s/^[ \t]*//;
	s/&nbsp;//;
	tr/a-z/A-Z/;
	chomp;

	s/\bROAD\b/RD/g;

	if (/[A-Za-z0-9]/) {
		print "$lat{$_},$lon{$_}, $_\n";
	} else {
		print STDERR "$file\n";
	}

	close(IN);
}
